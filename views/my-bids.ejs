<%- include('layout/header') %> <%- include('layout/navbar') %>

<div class="container my-5">
  <h1 class="mb-4">
    <i class="fas fa-history text-primary"></i> Lịch sử đấu giá của tôi
  </h1>

  <% if (bids && bids.length > 0) { %>
  <div class="table-responsive">
    <table class="table table-striped table-hover">
      <thead class="table-dark">
        <tr>
          <th>Phiên đấu giá</th>
          <th>Giá đặt</th>
          <th>Thời gian</th>
          <th>Trạng thái</th>
          <th>Kết quả</th>
        </tr>
      </thead>
      <tbody>
        <% bids.forEach(bid => { %>
        <tr>
          <td>
            <a href="/auction/<%= bid.Auction.auction_id %>">
              <%= bid.Auction.title %>
            </a>
          </td>
          <td class="text-success">
            <strong
              ><%= parseFloat(bid.bid_amount).toLocaleString('vi-VN') %>
              VNĐ</strong
            >
          </td>
          <td><%= new Date(bid.bid_time).toLocaleString('vi-VN') %></td>
          <td>
            <% if (bid.Auction.status === 'ACTIVE') { %>
            <span class="badge bg-success">Đang diễn ra</span>
            <% } else { %>
            <span class="badge bg-secondary">Đã kết thúc</span>
            <% } %>
          </td>
          <td>
            <% if (bid.Auction.status === 'ENDED') { %> <% if
            (bid.Auction.highest_bidder_id === user.user_id) { %>
            <span class="badge bg-warning"
              ><i class="fas fa-trophy"></i> Thắng</span
            >
            <% } else { %>
            <span class="badge bg-danger">Thua</span>
            <% } %> <% } else { %> <% if (bid.Auction.highest_bidder_id ===
            user.user_id) { %>
            <span class="badge bg-info">Đang dẫn đầu</span>
            <% } else { %>
            <span class="badge bg-warning">Bị đè giá</span>
            <% } %> <% } %>
          </td>
        </tr>
        <% }) %>
      </tbody>
    </table>
  </div>
  <% } else { %>
  <div class="alert alert-info">
    <i class="fas fa-info-circle"></i> Bạn chưa tham gia đấu giá nào.
    <a href="/dashboard" class="alert-link"
      >Xem các phiên đấu giá đang diễn ra</a
    >
  </div>
  <% } %>
</div>

<%- include('layout/footer') %>
